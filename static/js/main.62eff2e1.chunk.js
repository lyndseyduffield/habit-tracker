(this["webpackJsonphabit-tracker"]=this["webpackJsonphabit-tracker"]||[]).push([[0],{126:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(32),c=a.n(s),l=a(40),i=a(9),o=a(4),u=a(3),d=a(36),m=a(13),b=a.n(m),p=function(e){return e?Object.keys(e):[]};var h=function(e){var t=b()().startOf("day"),a=E(e.startDate.startOf("day"),e.endDate.startOf("day"),e.streak,t);return Object(u.a)({},e,{streak:a})},E=function(e,t,a,r){var n=a;if(e.isAfter(r,"day"))n=[];else{var s=a.length,c=f(r,e,t);if(c>s)for(var l=c-s,i=0;i<l;i++)n.push(!1);else c<s&&(n=n.slice(0,c))}return n},f=function(e,t,a){return t.isAfter(e,"days")?0:a.isAfter(e,"days")?e.diff(t,"days")+1:a.diff(t,"days")+1},v=function(e){return{type:"DELETE_HABIT",value:e}},g=function(e,t){return{type:"UPDATE_STREAK",value:{id:e,check:t}}},O=function(e){return{type:"UPDATE_CURRENT_USER",value:e}},j={initialized:!1,currentUser:null,userStates:{}};function y(e,t){switch(t.type){case"SET_STATE":return t.value;case"ADD_HABIT":var a=e.currentUser;if(a){var r=e.userStates[a],n=r.lastId+1,s={lastId:n,habits:Object(u.a)({},r.habits,Object(o.a)({},n,t.value))};return Object(u.a)({},e,{userStates:Object(u.a)({},e.userStates,Object(o.a)({},a,s))})}return e;case"EDIT_HABIT":var c=e.currentUser;if(c){var l=t.value.habit,i=e.userStates[c],d=Object(u.a)({},i,{habits:Object(u.a)({},i.habits,Object(o.a)({},t.value.id,l))});return Object(u.a)({},e,{userStates:Object(u.a)({},e.userStates,Object(o.a)({},c,d))})}return e;case"DELETE_HABIT":var m=e.currentUser;if(m){var b=t.value,p=e.userStates[m],h=Object(u.a)({},p,{habits:(k=p.habits,A=b,Object.keys(k).filter((function(e){return A!==e})).reduce((function(e,t){return Object(u.a)({},e,Object(o.a)({},t,k[t]))}),{}))});return Object(u.a)({},e,{userStates:Object(u.a)({},e.userStates,Object(o.a)({},m,h))})}return e;case"UPDATE_STREAK":var E=e.currentUser;if(E){var f=e.userStates[E],v=t.value,g=v.id,O=v.check,j=f.habits[g],y=j.streak;y[y.length-1]=O;var S=Object(u.a)({},f,{habits:Object(u.a)({},f.habits,Object(o.a)({},g,Object(u.a)({},j,{streak:y})))});return Object(u.a)({},e,{userStates:Object(u.a)({},e.userStates,Object(o.a)({},E,S))})}return e;case"UPDATE_CURRENT_USER":var w=t.value;return Object(u.a)({},e,{currentUser:w});case"REGISTER_USER":var D=t.value;return Object(u.a)({},e,{userStates:Object(u.a)({},e.userStates,Object(o.a)({},D,{lastId:0,habits:{}}))});default:return e}var k,A}var S=function(e){var t=Object.keys(e.userStates).map((function(t){return{user:t,state:w(e.userStates[t])}})).reduce((function(e,t){var a=t.user,r=t.state;return Object(u.a)({},e,Object(o.a)({},a,r))}),{});return Object(u.a)({},e,{userStates:t})},w=function(e){if(e==={})return j;var t=(e.habits?Object.keys(e.habits):[]).reduce((function(t,a){var r=e.habits[a],n=b()(r.startDate,b.a.ISO_8601),s=b()(r.endDate,b.a.ISO_8601),c=h(Object(u.a)({},r,{startDate:n,endDate:s}));return Object(u.a)({},t,Object(o.a)({},a,c))}),{});return Object(u.a)({},e,{habits:t})},D=a(25),k=a(26),A=a(28),T=a(27),U=a(29),I=a(16),C=a(30),x=function(e){return n.a.createElement("label",{class:"checkbox-label"},e.children,e.disabled?n.a.createElement("span",{class:"checkbox-custom checkbox-disabled rectangular"}):n.a.createElement("span",{class:"checkbox-custom rectangular"}))},_=(a(66),function(e){function t(){var e,a;Object(D.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(A.a)(this,(e=Object(T.a)(t)).call.apply(e,[this].concat(n)))).handleStreakClick=function(e){var t=a.props.id||a.props.match.params.id,r=e.target.checked;a.props.dispatch(g(t,r))},a.handleDeleteClick=function(e,t){e.preventDefault(),a.props.dispatch(v(t))},a}return Object(U.a)(t,e),Object(k.a)(t,[{key:"renderStreak",value:function(e,t){var a=this;switch(function(e,t,a){return 0===e.length?"NO_STREAK":a.isAfter(t,"days")?"DISABLED_STREAK":"ACTIVE_STREAK"}(e,t,b()().startOf("day"))){case"NO_STREAK":return n.a.createElement("div",null,"This habit hasn't started yet!");case"DISABLED_STREAK":return e.map((function(e,t){return n.a.createElement(x,{key:t,disabled:!0},n.a.createElement("input",{type:"checkbox",disabled:!0,checked:e}))}));case"ACTIVE_STREAK":var r=e.length-1;return e.map((function(e,t){return t===r?n.a.createElement(x,{key:t},n.a.createElement("input",{type:"checkbox",onChange:function(e){return a.handleStreakClick(e)},checked:e})):n.a.createElement(x,{disabled:!0,key:t},n.a.createElement("input",{type:"checkbox",disabled:!0,checked:e}))}));default:console.log("Oops! Something went wrong")}}},{key:"renderExpanded",value:function(){var e=this,t=this.props.habit,a=t.title,r=t.goal,s=t.streak,c=t.startDate,l=t.endDate,i=this.props.habit.accountabilityPartner,o=i.name,u=i.email,d=l?l.format("MMMM Do, YYYY"):null,m=c?c.format("MMMM Do, YYYY"):null;return n.a.createElement("div",{class:"section"},n.a.createElement("div",{class:"card card-border"},n.a.createElement("header",{class:"card-header card-element-background"},n.a.createElement("p",{class:"card-header-title header-font"},a)),n.a.createElement("div",{class:"card-content"},n.a.createElement("div",{class:"content flex-item"},n.a.createElement("div",{class:"flex-element"},n.a.createElement("h3",null,"Goal"),n.a.createElement("p",null,r)),n.a.createElement("div",{class:"flex-element"},n.a.createElement("h3",null,"Accountability Partner"),n.a.createElement("p",null,"name: ",o),n.a.createElement("p",null,"email: ",u)))),n.a.createElement("div",{class:"card-content"},n.a.createElement("div",{class:"content"},m," - ",d)),n.a.createElement("div",{class:"card-content"},n.a.createElement("div",{class:"content streak"},this.renderStreak(s,l))),n.a.createElement("footer",{class:"card-footer card-element-background"},n.a.createElement(I.b,{class:"card-footer-item is-dark",to:"/".concat(this.props.id,"/edit")},n.a.createElement("strong",null,"Edit")),n.a.createElement("a",{href:"/",class:"card-footer-item is-dark",onClick:function(t){e.handleDeleteClick(t,e.props.id)}},n.a.createElement("strong",null,"Delete")))))}},{key:"renderCollapsed",value:function(){var e=this.props.habit,t=e.streak,a=e.title,r=e.endDate,s=t;if(s.length>=7){var c=s.length-7,l=s.length;s=s.slice(c,l)}return n.a.createElement("div",null,n.a.createElement("div",{class:"compact-card"},n.a.createElement("div",{class:"compact-card-header"},a),n.a.createElement("div",null,this.renderStreak(s,r))))}},{key:"render",value:function(){var e=this.props,t=e.collapsed;return e.habit?t?this.renderCollapsed():this.renderExpanded():""}}]),t}(n.a.Component)),P=Object(i.b)((function(e,t){var a;try{a=t.match.params.id}catch(n){a=t.id}var r=e.currentUser;return r?{habit:e.userStates[r].habits[a]}:{habit:null}}))(_),R=function(e){function t(){var e,a;Object(D.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(a=Object(A.a)(this,(e=Object(T.a)(t)).call.apply(e,[this].concat(s)))).renderEmpty=function(){return n.a.createElement("div",{class:"hero"},n.a.createElement("div",{class:"hero-body"},n.a.createElement("div",{class:"container"},n.a.createElement("h1",{class:"title"},"Create a New Habit!"),n.a.createElement("div",null),n.a.createElement(I.b,{to:"/new",class:"subtitle button banner-button"},"Get to it"))))},a}return Object(U.a)(t,e),Object(k.a)(t,[{key:"habitList",value:function(){var e=this;return this.props.habitIds.map((function(t){return n.a.createElement("div",{key:t},n.a.createElement(P,{collapsed:e.props.collapsed,id:t}))}))}},{key:"render",value:function(){return 0===this.props.habitIds.length?n.a.createElement("div",{class:"container"},this.renderEmpty()):n.a.createElement("div",{class:"container"},this.habitList())}}]),t}(n.a.Component),N=Object(i.b)((function(e){var t=e.currentUser;return t?{habitIds:p(e.userStates[t].habits)}:{habitIds:[]}}))(R),Y=a(10),L=a(35),M=a(63),q=a.n(M),H=(a(124),Object(i.b)((function(e,t){var a=e.currentUser;return a?{habit:e.userStates[a].habits[t.match.params.id]}:{habit:null}}))((function(e){var t=Object(r.useState)({startDate:e.now,endDate:e.now}),a=Object(Y.a)(t,2),s=a[0],c=a[1],l=Object(L.a)(),i=l.register,d=l.handleSubmit,m=l.setValue,p=l.errors;n.a.useEffect((function(){i({name:"startDate"}),i({name:"endDate"})}),[i,m]),n.a.useEffect((function(){if(e.habit){var t=e.habit.startDate.toDate(),a=e.habit.endDate.toDate();m("startDate",t),m("endDate",a),c({startDate:t,endDate:a})}else m("startDate",e.now),m("endDate",e.now)}),[m,e]);var E=function(e,t){"startDate"===e&&t>s.endDate?(m("startDate",t),m("endDate",t),c({startDate:t,endDate:t})):(m(e,t),c(Object(u.a)({},s,Object(o.a)({},e,t))))};return console.log(e),n.a.createElement("form",{class:"form-container",onSubmit:d((function(t){if(e.habit){var a=e.match.params.id,r=b()(t.startDate),n=b()(t.endDate),s=h(Object(u.a)({},e.habit,{},t,{startDate:r,endDate:n}));e.dispatch(function(e,t){return{type:"EDIT_HABIT",value:{id:t,habit:e}}}(s,a))}else{var c=b()(t.startDate),l=b()(t.endDate),i=h(Object(u.a)({},t,{startDate:c,endDate:l,streak:[]}));e.dispatch(function(e){return{type:"ADD_HABIT",value:e}}(i))}e.history.push("/")}))},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Habit"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"text",name:"title",defaultValue:e.habit?e.habit.title:"",placeholder:"Your new habit.",ref:i({required:!0})})),p.title&&n.a.createElement("p",{class:"help is-danger"},'"A title is required"')),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Goal"),n.a.createElement("div",{class:"control"},n.a.createElement("textarea",{class:"textarea",type:"text",name:"goal",defaultValue:e.habit?e.habit.goal:"",placeholder:"What is your goal?",ref:i}))),n.a.createElement("div",{class:"field is-grouped is-horizontal"},n.a.createElement("div",{class:"field-body"},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Start Date"),n.a.createElement("div",{class:"control"},n.a.createElement(q.a,{minDate:e.now,selected:s.startDate,onChange:function(e){E("startDate",e)}}))),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"End Date"),n.a.createElement("div",{class:"control"},n.a.createElement(q.a,{minDate:s.startDate,selected:s.endDate,onChange:function(e){E("endDate",e)}}))))),n.a.createElement("h3",{class:"label is-large margin-top"},"Accountability Partner"),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Name"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"text",name:"accountabilityPartner.name",defaultValue:e.habit?e.habit.accountabilityPartner.name:"",placeholder:"Your accountability partner's name",ref:i({maxLength:{value:40,message:"This name is too long"}})})),n.a.createElement("p",{class:"help is-danger"},p["accountabilityPartner.name"]?n.a.createElement("span",null,p["accountabilityPartner.name"].message):"")),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Email"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"text",name:"accountabilityPartner.email",defaultValue:e.habit?e.habit.accountabilityPartner.email:"",placeholder:"Their email",ref:i({pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Please enter a valid email"}})})),n.a.createElement("p",{class:"help is-danger"},p["accountabilityPartner.email"]?n.a.createElement("span",null,p["accountabilityPartner.email"].message):"")),n.a.createElement("div",{class:"control margin-top"},n.a.createElement("button",{class:"button is-link"},"Submit")))}))),z=function(e){function t(){var e,a;Object(D.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(a=Object(A.a)(this,(e=Object(T.a)(t)).call.apply(e,[this].concat(s)))).buttonLabel=function(){return a.props.collapsed?n.a.createElement("strong",null,"Expand View"):n.a.createElement("strong",null,"Collapse View")},a.handleLogout=function(){a.props.dispatch(O(null))},a}return Object(U.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){var e=this,t="/"===this.props.location.pathname&&this.props.habitIds.length>0;return n.a.createElement("nav",{class:"navbar has-shadow"},n.a.createElement("div",{class:"navbar-brand"},n.a.createElement(I.b,{to:"/",class:"navbar-item"},n.a.createElement("strong",null,"HabitTracker"))),n.a.createElement("div",{class:"navbar-end"},n.a.createElement("div",{class:"navbar-item"},n.a.createElement("div",{class:"buttons"},n.a.createElement(I.b,{to:"/new",class:"button is-light"},n.a.createElement("strong",null,"New Habit")),t&&n.a.createElement("div",{onClick:function(t){return e.props.toggleCollapse(t)},class:"button is-light"},this.buttonLabel()),n.a.createElement("button",{onClick:function(t){return e.handleLogout(t)},class:"button is-light"},n.a.createElement("strong",null,"Logout"))))))}}]),t}(n.a.Component),B=Object(i.b)((function(e){var t=e.currentUser;return t?{habitIds:p(e.userStates[t].habits)}:{habitIds:[]}}))(z),V=Object(C.g)(B),J=function(e,t){return t[e.username]?t:Object(u.a)({},t,Object(o.a)({},e.username,e.password))},K=Object(i.b)()((function(e){var t=Object(L.a)(),a=t.register,r=t.handleSubmit,s=t.errors,c=t.setError;return n.a.createElement("form",{class:"form-container",onSubmit:r((function(t){if(JSON.parse(window.localStorage.getItem("users"))[t.username])c("username","invalid","Username is not available");else if(t.password!==t.verifypassword)c("password","notMatch","Passwords must match."),c("password","notMatch","Passwords must match.");else{var a={username:t.username,password:t.password};!function(e){try{var t=JSON.parse(window.localStorage.getItem("users")),a=J(e,t);window.localStorage.setItem("users",JSON.stringify(a))}catch(r){console.log("Failed to add user due to encoding error")}}(a),e.dispatch({type:"REGISTER_USER",value:a.username}),e.dispatch(O(a.username)),e.history.push("/")}}))},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Username"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"text",name:"username",placeholder:"Your username here",ref:a({required:"A username is required"})})),s.username&&n.a.createElement("p",{class:"help is-danger"},s.username.message)),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Password"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"password",name:"password",placeholder:"Your password here",ref:a({required:"A password is required"})})),s.password&&n.a.createElement("p",{class:"help is-danger"},s.password.message)),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Password"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"password",name:"verifypassword",placeholder:"Your password here",ref:a({required:"A password is required"})})),s.password&&n.a.createElement("p",{class:"help is-danger"},s.password.message)),n.a.createElement("div",{class:"control margin-top"},n.a.createElement("button",{type:"submit",class:"button is-link"},"Sign Up")))})),G=Object(i.b)((function(e){return{currentUser:e.currentUser}}))((function(e){var t=e.currentUser,a=Object(d.a)(e,["currentUser"]),r=Object(L.a)(),s=r.register,c=r.handleSubmit,l=r.errors,i=r.setError,o=function(e){!function(e,t){return!(!t[e.username]||t[e.username]!==e.password)}(e,JSON.parse(window.localStorage.getItem("users")))?(i("username","notMatch","invalid username"),i("password","notMatch","invalid password")):(a.dispatch(O(e.username)),a.history.push("/"))};return t?n.a.createElement(C.a,{to:{pathname:"/"}}):n.a.createElement("form",{class:"form-container",onSubmit:c(o)},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Username"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"text",name:"username",placeholder:"Your username here",ref:s({required:"A username is required"})})),l.username&&n.a.createElement("p",{class:"help is-danger"},l.username.message)),n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label is-large"},"Password"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{class:"input",type:"password",name:"password",placeholder:"Your password here",ref:s({required:"A password is required"})})),l.password&&n.a.createElement("p",{class:"help is-danger"},l.password.message)),n.a.createElement("div",{class:"login-buttons"},n.a.createElement("div",{class:"control margin-top"},n.a.createElement("button",{type:"submit",class:"button is-link"},"Signin")),n.a.createElement(I.b,{to:"/signup",class:"control margin-top"},n.a.createElement("button",{class:"button is-link"},"Sign Up"))))})),F=Object(i.b)((function(e){return{currentUser:e.currentUser,initialized:e.initialized}}))((function(e){var t=e.currentUser,a=e.initialized,r=e.render,s=Object(d.a)(e,["currentUser","initialized","render"]);return a?t?n.a.createElement(C.b,Object.assign({},s,{render:r})):n.a.createElement(C.b,Object.assign({},s,{render:function(e){var t=e.location;return n.a.createElement(C.a,{to:{pathname:"/login",state:{from:t}}})}})):"Loading..."})),W=function(e){function t(){var e,a;Object(D.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(a=Object(A.a)(this,(e=Object(T.a)(t)).call.apply(e,[this].concat(s)))).state={collapsed:!1},a.toggleCollapse=function(e){e.preventDefault(),a.setState((function(e){return{collapsed:!e.collapsed}}))},a.renderNavbar=function(){return n.a.createElement(V,{collapsed:a.state.collapsed,toggleCollapse:a.toggleCollapse})},a}return Object(U.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){var e=function(){try{var e=window.localStorage.getItem("state"),t=JSON.parse(e);return S(t)}catch(a){return console.log("Failed to read state from local storage"),j}}();this.props.dispatch(function(e){return{type:"SET_STATE",value:e}}(Object(u.a)({},e,{initialized:!0})))}},{key:"render",value:function(){var e=this;return n.a.createElement(I.a,{basename:"/habit-tracker"},this.props.currentUser?this.renderNavbar():"",n.a.createElement(C.d,null,n.a.createElement(C.b,{path:"/login",render:function(e){return n.a.createElement(G,e)}}),n.a.createElement(C.b,{path:"/signup",render:function(e){return n.a.createElement(K,e)}}),n.a.createElement(F,{exact:!0,path:"/",render:function(t){return n.a.createElement(N,Object.assign({},t,{collapsed:e.state.collapsed}))}}),n.a.createElement(F,{path:"/new",render:function(e){return n.a.createElement(H,Object.assign({},e,{now:new Date}))}}),n.a.createElement(F,{path:"/:id/edit",render:function(e){return n.a.createElement(H,Object.assign({},e,{now:new Date}))}}),n.a.createElement(F,{path:"/:id/show",component:P})))}}]),t}(n.a.Component),$=Object(i.b)((function(e){return{currentUser:e.currentUser}}))(W),Q=Object(l.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;return y(e,t)}),Object(l.a)((function(e){return function(t){return function(a){var r=t(a),n=e.getState(),s=(n.initialized,Object(d.a)(n,["initialized"]));return window.localStorage.setItem("state",JSON.stringify(s)),r}}})));c.a.render(n.a.createElement(i.a,{store:Q},n.a.createElement($,null)),document.getElementById("root"))},66:function(e,t,a){},70:function(e,t,a){e.exports=a(126)}},[[70,1,2]]]);
//# sourceMappingURL=main.62eff2e1.chunk.js.map